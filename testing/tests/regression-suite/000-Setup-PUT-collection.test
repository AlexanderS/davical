#
# PUT a calendar collection to user2 so we have some starting events
#
# There is no CalDAV defined behaviour for this.
#
TYPE=PUT
URL=http://mycaldav/caldav.php/user2/home/
HEADER=User-Agent: RSCDS Testing/0.7.x
HEADER=Content-Type: text/calendar; charset=utf-8
AUTH=admin:nimda

HEAD

BEGINDATA
BEGIN:VCALENDAR
PRODID:-//Mozilla.org/NONSGML Mozilla Calendar V1.1//EN
X-WR-CALNAME:User 2's Calendar, as uploaded by Admin
VERSION:2.0

BEGIN:VTIMEZONE
TZID:Pacific/Auckland
X-LIC-LOCATION:Pacific/Auckland
BEGIN:DAYLIGHT
TZOFFSETFROM:+1200
TZOFFSETTO:+1300
TZNAME:NZDT
DTSTART:19700927T020000
RRULE:FREQ=YEARLY;INTERVAL=1;BYDAY=-1SU;BYMONTH=9
END:DAYLIGHT
BEGIN:STANDARD
TZOFFSETFROM:+1300
TZOFFSETTO:+1200
TZNAME:NZST
DTSTART:19700405T030000
RRULE:FREQ=YEARLY;INTERVAL=1;BYDAY=1SU;BYMONTH=4
END:STANDARD
END:VTIMEZONE

BEGIN:VEVENT
CREATED:20081023T054958Z
LAST-MODIFIED:20081023T055044Z
DTSTAMP:20081023T054958Z
UID:33169d69-2969-4a96-a3e1-2e312b7614e6
SUMMARY:Near Daily Action Meeting
RRULE:FREQ=DAILY;INTERVAL=1;BYDAY=MO,WE,FR
DTSTART;TZID=Pacific/Auckland:20081020T110000
DTEND;TZID=Pacific/Auckland:20081020T113000
X-MOZ-GENERATION:2
END:VEVENT

BEGIN:VEVENT
CREATED:20081023T054934Z
LAST-MODIFIED:20081023T055059Z
DTSTAMP:20081023T054934Z
UID:047871e3-6b70-4178-9af8-0ceb50f7b092
SUMMARY:Weekly Project Meeting
RRULE:FREQ=WEEKLY;INTERVAL=1
DTSTART;TZID=Pacific/Auckland:20081020T090000
DTEND;TZID=Pacific/Auckland:20081020T100000
X-MOZ-GENERATION:2
END:VEVENT

BEGIN:VEVENT
CREATED:20081023T055115Z
LAST-MODIFIED:20081023T055139Z
DTSTAMP:20081023T055115Z
UID:9429a973-2b13-4b1a-be09-948d75425c45
SUMMARY:Weekly catch-up
RRULE:FREQ=WEEKLY;INTERVAL=1
DTSTART;TZID=Pacific/Auckland:20081024T140000
DTEND;TZID=Pacific/Auckland:20081024T150000
X-MOZ-GENERATION:2
END:VEVENT

BEGIN:VEVENT
LAST-MODIFIED:20080303T015422Z
SEQUENCE:5
UID:7d729xc0-0895-012d-124e-002421a2359e
SUMMARY:1st Monday, 2nd Tuesday, 3rd Thursday & Last Friday
RRULE:FREQ=MONTHLY;BYDAY=1MO,2TU,3TH,-1FR;INTERVAL=1
DESCRIPTION:An all day event on various days.
DTSTART;TZID=America/Los_Angeles:20081006T000000
CREATED:20080303T015329Z
DTSTAMP:20080303T015422Z
DURATION:P1D
END:VEVENT

BEGIN:VEVENT
LAST-MODIFIED:20081123T210725Z
SEQUENCE:6
UID:bd262d20-1cdb-012d-1264-002421a2359e
SUMMARY:Afternoon run
DESCRIPTION:
DTSTART;TZID=America/Los_Angeles:20081123T150000
CREATED:20081123T210644Z
DTSTAMP:20081123T210725Z
DURATION:PT1H
LOCATION:
RRULE:FREQ=WEEKLY;INTERVAL=1;BYDAY=SU
END:VEVENT

BEGIN:VTIMEZONE
TZID:America/Los_Angeles
X-TZINFO:America/Los_Angeles[2007g/Partial@883612800000]
BEGIN:DAYLIGHT
TZOFFSETTO:-0700
TZOFFSETFROM:-0800
TZNAME:America/Los_Angeles(DST)
DTSTART:19980405T020000
RRULE:FREQ=YEARLY;UNTIL=20060403T100000Z;BYMONTH=4;BYDAY=1SU
END:DAYLIGHT
BEGIN:STANDARD
TZOFFSETTO:-0800
TZOFFSETFROM:-0700
TZNAME:America/Los_Angeles(STD)
DTSTART:19981025T020000
RRULE:FREQ=YEARLY;UNTIL=20061030T100000Z;BYMONTH=10;BYDAY=-1SU
END:STANDARD
BEGIN:DAYLIGHT
TZOFFSETTO:-0700
TZOFFSETFROM:-0800
TZNAME:America/Los_Angeles(DST)
DTSTART:20070311T020000
RRULE:FREQ=YEARLY;BYMONTH=3;BYDAY=2SU
END:DAYLIGHT
BEGIN:STANDARD
TZOFFSETTO:-0800
TZOFFSETFROM:-0700
TZNAME:America/Los_Angeles(STD)
DTSTART:20071104T020000
RRULE:FREQ=YEARLY;BYMONTH=11;BYDAY=1SU
END:STANDARD
END:VTIMEZONE
END:VCALENDAR
ENDDATA

QUERY
SELECT caldav_data.user_no, caldav_type, logged_user, 
       uid, dtstamp, dtstart at time zone tz_locn as dtstart, dtend at time zone tz_locn as dtend, due, summary, location,
       description, priority, class, transp, rrule, url,
       percent_complete, tz_id, status,
       caldav_data AS "A1 CalDAV DATA"
FROM caldav_data JOIN calendar_item USING(dav_name) JOIN time_zone USING (tz_id)
WHERE caldav_data.dav_name ~ '^/user2/home/'
ENDQUERY

QUERY
SELECT count(*)
  FROM caldav_data JOIN calendar_item USING(dav_name)
  WHERE caldav_data.dav_name ~ '^/user2/home/'
ENDQUERY

